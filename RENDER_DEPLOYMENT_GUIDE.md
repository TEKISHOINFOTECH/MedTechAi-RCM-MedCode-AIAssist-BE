# Render Deployment Guide for MedTechAI RCM Backend

This guide will help you deploy your MedTechAI RCM backend to Render.

## Prerequisites

1. **Render Account**: Sign up at [render.com](https://render.com)
2. **GitHub Repository**: Your code should be in a GitHub repository
3. **API Keys**: Have your OpenAI and Anthropic API keys ready

## Deployment Steps

### 1. Prepare Your Repository

Make sure your repository has:
- ✅ `render.yaml` configuration file
- ✅ `Dockerfile` (for containerized deployment)
- ✅ `.env.example` file
- ✅ All dependencies in `pyproject.toml`

### 2. Deploy to Render

#### Option A: Using render.yaml (Recommended)

1. **Connect GitHub Repository**:
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New +" → "Blueprint"
   - Connect your GitHub repository
   - Select your repository

2. **Render will automatically**:
   - Detect the `render.yaml` file
   - Create the web service and database
   - Set up environment variables

#### Option B: Manual Setup

1. **Create Web Service**:
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
   - Configure:
     - **Name**: `medtechai-rcm-backend`
     - **Environment**: `Python 3`
     - **Build Command**: 
       ```bash
       curl -LsSf https://astral.sh/uv/install.sh | sh
       export PATH="$HOME/.cargo/bin:$PATH"
       uv sync --frozen --no-dev
       uv run python scripts/init.py
       ```
     - **Start Command**: 
       ```bash
       uv run uvicorn app.main:app --host 0.0.0.0 --port $PORT
       ```

2. **Create Database**:
   - Click "New +" → "PostgreSQL"
   - Name: `medtechai-db`
   - Plan: `Starter` (free tier)

### 3. Configure Environment Variables

In your Render service dashboard, go to "Environment" tab and add:

#### Required Variables:
```
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO
SECRET_KEY=<generate-a-secure-secret-key>
```

#### Database:
```
DATABASE_URL=<auto-generated-by-render>
```

#### AI Services (Add your actual keys):
```
OPENAI_API_KEY=sk-proj-your-openai-key-here
ANTHROPIC_API_KEY=your-anthropic-key-here
```

#### Optional Variables:
```
RAG_ENABLED=true
VECTOR_DB_DIR=/opt/render/project/rag_index
INGEST_DOCS_DIR=/opt/render/project/docs
CONFIDENCE_THRESHOLD=0.85
```

### 4. Deploy

1. **Push to GitHub**:
   ```bash
   git add .
   git commit -m "Add Render deployment configuration"
   git push origin main
   ```

2. **Trigger Deployment**:
   - Render will automatically detect the push
   - Or manually trigger from Render dashboard

### 5. Verify Deployment

Once deployed, test your endpoints:

- **Health Check**: `https://your-app-name.onrender.com/health`
- **API Docs**: `https://your-app-name.onrender.com/docs`
- **Root**: `https://your-app-name.onrender.com/`

## Configuration Details

### render.yaml Breakdown

```yaml
services:
  - type: web
    name: medtechai-rcm-backend
    env: python
    plan: starter  # Free tier
    buildCommand: |
      # Install UV and dependencies
      curl -LsSf https://astral.sh/uv/install.sh | sh
      export PATH="$HOME/.cargo/bin:$PATH"
      uv sync --frozen --no-dev
      uv run python scripts/init.py
    startCommand: uv run uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
```

### Database Configuration

The `render.yaml` includes a PostgreSQL database:
- **Name**: `medtechai-db`
- **Plan**: `starter` (free tier)
- **Connection**: Automatically provided via `DATABASE_URL`

## Troubleshooting

### Common Issues:

1. **Build Failures**:
   - Check that all dependencies are in `pyproject.toml`
   - Verify UV installation in build command

2. **Runtime Errors**:
   - Check environment variables are set correctly
   - Verify API keys are valid

3. **Database Connection**:
   - Ensure `DATABASE_URL` is set
   - Check database is running

### Logs and Debugging:

1. **View Logs**:
   - Go to your service in Render dashboard
   - Click "Logs" tab

2. **Debug Locally**:
   ```bash
   # Test with production settings
   ENVIRONMENT=production DEBUG=false uv run uvicorn app.main:app --host 0.0.0.0 --port 8000
   ```

## Cost Optimization

### Free Tier Limits:
- **Web Service**: 750 hours/month
- **Database**: 1GB storage
- **Bandwidth**: 100GB/month

### Upgrade Options:
- **Starter Plan**: $7/month for more resources
- **Standard Plan**: $25/month for production workloads

## Security Considerations

1. **Environment Variables**:
   - Never commit API keys to repository
   - Use Render's secure environment variable storage

2. **Database Security**:
   - Database is only accessible from your Render services
   - Connection string is automatically managed

3. **HTTPS**:
   - Render provides automatic HTTPS
   - All traffic is encrypted

## Monitoring

1. **Health Checks**:
   - Automatic health checks on `/health` endpoint
   - Service restarts automatically if unhealthy

2. **Metrics**:
   - CPU and memory usage in dashboard
   - Request logs and error tracking

## Next Steps

After successful deployment:

1. **Test API Endpoints**:
   - Validate medical codes
   - Test claim processing
   - Check agent health

2. **Connect Frontend**:
   - Update frontend API URLs
   - Configure CORS if needed

3. **Set up Monitoring**:
   - Configure alerts
   - Set up logging aggregation

## Support

- **Render Documentation**: [docs.render.com](https://docs.render.com)
- **Render Support**: Available in dashboard
- **Project Issues**: GitHub repository issues
