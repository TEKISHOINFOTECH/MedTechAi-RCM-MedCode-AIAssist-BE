services:
  - type: web
    name: medtechai-rcm-backend
    env: python
    plan: free
    buildCommand: |
      # Install UV
      curl -LsSf https://astral.sh/uv/install.sh | sh
      export PATH="$HOME/.cargo/bin:$PATH"
      
      # Install dependencies
      uv sync --frozen --no-dev
    startCommand: uv run uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: false
      - key: LOG_LEVEL
        value: INFO
      - key: DATABASE_URL
        fromDatabase:
          name: medtechai-db
          property: connectionString
      - key: OPENAI_API_KEY
        sync: false  # Will be set manually in Render dashboard
      - key: ANTHROPIC_API_KEY
        sync: false  # Will be set manually in Render dashboard
      - key: SECRET_KEY
        generateValue: true
      - key: RAG_ENABLED
        value: true
      - key: VECTOR_DB_DIR
        value: /opt/render/project/rag_index
      - key: INGEST_DOCS_DIR
        value: /opt/render/project/docs

databases:
  - name: medtechai-db
    plan: free
    databaseName: medtechai_rcm
    user: medtechai_user
